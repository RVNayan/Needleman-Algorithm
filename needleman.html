<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    .header {
    font-size:50px;
    text-align:center;
    }
    .border1 {
    background-color: green;
    height:200px;
    }
    
    #intro {
    position: relative;
    top: 20px;
    left:20px;
    font-size:15px;
    height: 100%;
    width:50%;
    color: white;
    overflow: auto;
    /*overflow-wrap: break-word;*/

    }
    #sequence1 {
    position : absolute;
    top: 125px;
    right: 10%;
    background-color: lightblue;
    padding: 10px;
    }
    #sequence2 {
    position : absolute;
    top: 175px;
    right: 10%;
    background-color: lightgrey;
    padding: 10px;
    }
    
    #butt {
    position : absolute;
    top:220px;
    right:25%;
    border-radius: 10px 10px;
    }
    
    .border2 {
    background-color: black;
    height:200px;
    }
    
    .table-container {
      display:flex;
  
      margin-right:20px;
    }
    .table1 {
      border-collapse: collapse;
      margin-bottom: 20px;
    
    }
    .table1 th, .table1 td {
      border: 1px dotted;
      padding: 10px;
      text-align: center;
    }
    
    .tabel1 td {
      background-color: lightgrey;
    }

    .table1 th {
      background-color: lightblue;
    }
    th:nth-child(n), td:nth-child(n) {
    width:20px;
    }
   
  
    
    
  </style>
</head>

<body>
  
  <div class="border1"><header class="header"> Welcome </header><div>
  <div class="border2">
  <p id="intro"> The classical global pairwise alignment algorithm using dynamic programming is the Needleman–Wunsch algorithm.  In this algorithm, an optimal alignment is obtained over the entire lengths of the two sequences.  It must extend from the beginning to the end of both sequencs to achieve the highest total score. In other words, the alignment path has to go from the bottom right corner of the matrix to the top left corner. This strategy is only suitable for aligning two closely related sequences that are of the same length. </p>
  <input type="text" id="sequence1" name="sequence1"><br>
  <input type="text" id="sequence2" name="sequence2"><br>
  <button onclick="handle()" id="butt">Click</button>
    
  </div>
  
  
  <div id="myPlot" style="width:100%;max-width:700px"></div>
  <div class="table-container">
    <table id="matrixtable1" class="table1">
      <caption>Score Table</caption>  
    </table>
  </div>
       
  <table id="matrixtable2">
    <caption>Diagonal Table</caption>
  </table>
 
  <script>
    // Clear existing tables
    function clearTables() {
      const matrixtable1 = document.getElementById("matrixtable1");
      const matrixtable2 = document.getElementById("matrixtable2");
      
      while (matrixtable1.firstChild) {
        matrixtable1.firstChild.remove();
      }
      
      while (matrixtable2.firstChild) {
        matrixtable2.firstChild.remove();
      }
    }
  
    // Check function for matching elements
    function check(matrix, posx, posy) {
      var dscore = 0;
      var upos = matrix[posx - 1][posy];
      var lpos = matrix[posx][posy - 1];
      var dpos = matrix[posx - 1][posy - 1];
      var cpos = matrix[posx][posy];
      var prevpos;

      if (matrix[posx][0] === matrix[0][posy]) {
        dscore = dpos + 1;
      } else {
        dscore = dpos - 1;
      }

      const lscore = lpos - 2;
      const uscore = upos - 2;
      const maxpos = Math.max(lscore, uscore, dscore);
      if (maxpos === lscore) {
        prevpos = [posx, posy - 1];
      }
      if (maxpos === uscore) {
        prevpos = [posx - 1, posy];
      }
      if (maxpos === dscore) {
        prevpos = [posx - 1, posy - 1];
      }
      return [maxpos, prevpos];
    }
    
    // Main code
    function handle() {
      clearTables(); // Clear existing tables

      const A = document.getElementById("sequence1").value;
      const B = document.getElementById("sequence2").value;
      var xArray = A.split("");
      var yArray = B.split("");

      var matrix = [];

      const h = yArray.length;
      const v = xArray.length;

      for (let i = 0; i < h + 2; i++) {
        matrix[i] = [];
        for (let j = 0; j < v + 2; j++) {
          matrix[i][j] = 0;
        }
      }

      for (let i = 0; i < h; i++) {
        for (let j = 0; j < v; j++) {
          if (i == 0) {
            matrix[i][j + 2] = A[j];
          }
          if (j == 0) {
            matrix[i + 2][j] = B[i];
          }
        }
      }

      for (let x = 1; x < h + 1; x++) {
        for (let y = 1; y < v + 1; y++) {
          if (x === 1) {
            matrix[x][y + 1] = y * (-2);
          }
          if (y === 1) {
            matrix[x + 1][y] = x * (-2);
          }
        }
      }
      var matrix2 = JSON.parse(JSON.stringify(matrix));

      for (let x = 2; x < h + 2; x++) {
        for (let y = 2; y < v + 2; y++) {
          const [r1, r2] = check(matrix, x, y);
          matrix[x][y] = r1;
          matrix2[x][y] = r2;
        }
      }

      // Display matrix as a table
      const matrixtable1 = document.getElementById("matrixtable1");
      for (let i = 0; i < h + 2; i++) {
        const row = document.createElement("tr");
        for (let j = 0; j < v + 2; j++) {
          const cell = document.createElement(i === 0 || j === 0 ? "th" : "td");
          cell.textContent = matrix[i][j];
          row.appendChild(cell);
        }
        matrixtable1.appendChild(row);
      }

      const matrixtable2 = document.getElementById("matrixtable2");
      for (let i = 0; i < h + 2; i++) {
        const row2 = document.createElement("tr");
        for (let j = 0; j < v + 2; j++) {
          const cell2 = document.createElement(i === 0 || j === 0 ? "th" : "td");

          if (i >= 2 && j >= 2) {
            const [r1, r2] = check(matrix, i, j);
            if (r2[0] === r2[1] || r2[0] - i === r2[1] - j) {
              cell2.textContent = "↖";
            }
            if (r2[0] === i) {
              cell2.textContent = "←";
            }
            if (r2[1] === j) {
              cell2.textContent = "↑";
            }
          }
          if (i === 0 || j === 0) {
            cell2.textContent = matrix2[i][j];
          }
          if (i === 1 && j > 1) {
            cell2.textContent = "←";
          }
          if (j === 1 && i > 1) {
            cell2.textContent = "↑";
          }
          if (i === 1 && j === 1) {
            cell2.textContent = '.';
          }
          row2.appendChild(cell2);
        }
        matrixtable2.appendChild(row2);
      }

      matrix2.length = 0;
    }
  </script>
</body>
</html>
